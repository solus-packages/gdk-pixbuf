From 695a0a069cc128e4addc531f991695dc6027c025 Mon Sep 17 00:00:00 2001
From: "Jan Alexander Steffens (heftig)" <jan.steffens@gmail.com>
Date: Mon, 7 Aug 2017 20:55:35 +0200
Subject: [PATCH 3/4] meson: Use include_directories references throughout

https://bugzilla.gnome.org/show_bug.cgi?id=785964
---
 contrib/gdk-pixbuf-xlib/meson.build   | 2 ++
 docs/reference/gdk-pixbuf/meson.build | 5 ++---
 gdk-pixbuf/meson.build                | 8 +++++---
 tests/meson.build                     | 2 +-
 4 files changed, 10 insertions(+), 7 deletions(-)

diff --git a/contrib/gdk-pixbuf-xlib/meson.build b/contrib/gdk-pixbuf-xlib/meson.build
index 71b50be3f..34f945b79 100644
--- a/contrib/gdk-pixbuf-xlib/meson.build
+++ b/contrib/gdk-pixbuf-xlib/meson.build
@@ -10,6 +10,8 @@ gdkpixbuf_xlib_headers = [
   'gdk-pixbuf-xlibrgb.h',
 ]
 
+gdkpixbuf_xlib_inc = include_directories('.')
+
 gdkpixbuf_xlib_api_path = join_paths('gdk-pixbuf-@0@'.format(gdk_pixbuf_api_version), 'gdk-pixbuf-xlib')
 
 install_headers(gdkpixbuf_xlib_headers, subdir: gdkpixbuf_xlib_api_path)
diff --git a/docs/reference/gdk-pixbuf/meson.build b/docs/reference/gdk-pixbuf/meson.build
index 3fb01f0e3..535ab5284 100644
--- a/docs/reference/gdk-pixbuf/meson.build
+++ b/docs/reference/gdk-pixbuf/meson.build
@@ -30,9 +30,8 @@ if get_option('with_docs')
   gnome.gtkdoc('gdk-pixbuf',
                main_xml: 'gdk-pixbuf.xml',
                src_dir: [
-                 join_paths(meson.source_root(), 'gdk-pixbuf'),
-                 join_paths(meson.build_root(), 'gdk-pixbuf'),
-                 join_paths(meson.source_root(), 'contrib', 'gdk-pixbuf-xlib'),
+                 gdk_pixbuf_inc,
+                 gdkpixbuf_xlib_inc,
                ],
                dependencies: gdk_pixbuf_deps,
                gobject_typesfile: 'gdk-pixbuf.types',
diff --git a/gdk-pixbuf/meson.build b/gdk-pixbuf/meson.build
index c52728220..bc4ef4ff2 100644
--- a/gdk-pixbuf/meson.build
+++ b/gdk-pixbuf/meson.build
@@ -21,6 +21,8 @@ loaders = [
   [ 'qtif', [ 'io-qtif.c' ] ]
 ]
 
+gdk_pixbuf_inc = include_directories('.')
+
 gdk_pixbuf_cflags = [
   '-DG_LOG_STRUCTURED=1',
   '-DG_LOG_DOMAIN="GdkPixbuf"',
@@ -102,7 +104,7 @@ foreach l: loaders
     mod = static_library('staticpixbufloader-@0@'.format(name),
                          sources,
                          dependencies: loaders_deps + gdk_pixbuf_deps,
-                         include_directories: [ root_inc, include_directories('.') ],
+                         include_directories: [ root_inc, gdk_pixbuf_inc ],
                          c_args: common_cflags + gdk_pixbuf_cflags)
 
     included_loaders_deps += declare_dependency(link_with: mod)
@@ -138,7 +140,7 @@ foreach l: loaders
     mod = shared_module('pixbufloader-@0@'.format(name),
                         sources,
                         dependencies: loaders_deps + gdk_pixbuf_deps + [ gdkpixbuf_dep ],
-                        include_directories: [ root_inc, include_directories('.') ],
+                        include_directories: [ root_inc, gdk_pixbuf_inc ],
                         c_args: common_cflags + gdk_pixbuf_cflags,
                         install: true,
                         install_dir: gdk_pixbuf_loaderdir)
@@ -160,7 +162,7 @@ foreach bin: gdkpixbuf_bin
 
   bin = executable(bin_name, bin_source,
                    dependencies: gdk_pixbuf_deps + [ gdkpixbuf_dep ],
-                   include_directories: [ root_inc, include_directories('.') ],
+                   include_directories: [ root_inc, gdk_pixbuf_inc ],
                    c_args: common_cflags + gdk_pixbuf_cflags,
                    install: true)
 
diff --git a/tests/meson.build b/tests/meson.build
index a40ea9413..33694e538 100644
--- a/tests/meson.build
+++ b/tests/meson.build
@@ -112,7 +112,7 @@ foreach t: installed_tests
                         dependencies: test_deps,
                         include_directories: [
                           root_inc,
-                          include_directories('../gdk-pixbuf')
+                          gdk_pixbuf_inc,
                         ],
                         c_args: common_cflags)
 
-- 
2.14.1

